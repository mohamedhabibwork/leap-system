"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.enrollmentsRelations = exports.lessonsRelations = exports.courseSectionsRelations = exports.coursesRelations = exports.certificates = exports.courseReviews = exports.quizAnswers = exports.quizAttempts = exports.assignmentSubmissions = exports.lessonProgress = exports.enrollments = exports.quizQuestions = exports.questionOptions = exports.questionBank = exports.quizzes = exports.assignments = exports.courseResources = exports.lessons = exports.courseSections = exports.courses = exports.courseCategories = void 0;
const pg_core_1 = require("drizzle-orm/pg-core");
const drizzle_orm_1 = require("drizzle-orm");
const lookups_schema_1 = require("./lookups.schema");
const users_schema_1 = require("./users.schema");
const subscriptions_schema_1 = require("./subscriptions.schema");
exports.courseCategories = (0, pg_core_1.pgTable)('course_categories', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    nameEn: (0, pg_core_1.varchar)('name_en', { length: 255 }).notNull(),
    nameAr: (0, pg_core_1.varchar)('name_ar', { length: 255 }),
    slug: (0, pg_core_1.varchar)('slug', { length: 255 }).notNull().unique(),
    descriptionEn: (0, pg_core_1.text)('description_en'),
    descriptionAr: (0, pg_core_1.text)('description_ar'),
    parentId: (0, pg_core_1.bigserial)('parent_id', { mode: 'number' }).references(() => exports.courseCategories.id),
    displayOrder: (0, pg_core_1.integer)('display_order').default(0),
    isActive: (0, pg_core_1.boolean)('isActive').default(true).notNull(),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('course_categories_uuid_idx').on(table.uuid),
    slugIdx: (0, pg_core_1.index)('course_categories_slug_idx').on(table.slug),
    parentIdx: (0, pg_core_1.index)('course_categories_parent_id_idx').on(table.parentId),
}));
exports.courses = (0, pg_core_1.pgTable)('courses', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    titleEn: (0, pg_core_1.varchar)('title_en', { length: 255 }).notNull(),
    titleAr: (0, pg_core_1.varchar)('title_ar', { length: 255 }),
    slug: (0, pg_core_1.varchar)('slug', { length: 255 }).notNull().unique(),
    descriptionEn: (0, pg_core_1.text)('description_en'),
    descriptionAr: (0, pg_core_1.text)('description_ar'),
    objectivesEn: (0, pg_core_1.text)('objectives_en'),
    objectivesAr: (0, pg_core_1.text)('objectives_ar'),
    requirementsEn: (0, pg_core_1.text)('requirements_en'),
    requirementsAr: (0, pg_core_1.text)('requirements_ar'),
    seo: (0, pg_core_1.jsonb)('seo'),
    instructorId: (0, pg_core_1.bigserial)('instructor_id', { mode: 'number' }).references(() => users_schema_1.users.id).notNull(),
    categoryId: (0, pg_core_1.bigserial)('category_id', { mode: 'number' }).references(() => exports.courseCategories.id),
    statusId: (0, pg_core_1.bigserial)('status_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id).notNull(),
    enrollmentTypeId: (0, pg_core_1.bigserial)('enrollment_type_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id),
    price: (0, pg_core_1.decimal)('price', { precision: 10, scale: 2 }),
    thumbnailUrl: (0, pg_core_1.varchar)('thumbnail_url', { length: 500 }),
    videoUrl: (0, pg_core_1.varchar)('video_url', { length: 500 }),
    durationHours: (0, pg_core_1.integer)('duration_hours'),
    maxStudents: (0, pg_core_1.integer)('max_students'),
    allowSubscriptionAccess: (0, pg_core_1.boolean)('allow_subscription_access').default(true).notNull(),
    allowPurchase: (0, pg_core_1.boolean)('allow_purchase').default(true).notNull(),
    publishDate: (0, pg_core_1.timestamp)('publish_date', { withTimezone: true }),
    isFeatured: (0, pg_core_1.boolean)('is_featured').default(false).notNull(),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    viewCount: (0, pg_core_1.integer)('view_count').default(0),
    favoriteCount: (0, pg_core_1.integer)('favorite_count').default(0),
    shareCount: (0, pg_core_1.integer)('share_count').default(0),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('courses_uuid_idx').on(table.uuid),
    slugIdx: (0, pg_core_1.index)('courses_slug_idx').on(table.slug),
    instructorIdx: (0, pg_core_1.index)('courses_instructor_id_idx').on(table.instructorId),
    categoryIdx: (0, pg_core_1.index)('courses_category_id_idx').on(table.categoryId),
    statusIdx: (0, pg_core_1.index)('courses_status_id_idx').on(table.statusId),
}));
exports.courseSections = (0, pg_core_1.pgTable)('course_sections', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    courseId: (0, pg_core_1.bigserial)('course_id', { mode: 'number' }).references(() => exports.courses.id).notNull(),
    titleEn: (0, pg_core_1.varchar)('title_en', { length: 255 }).notNull(),
    titleAr: (0, pg_core_1.varchar)('title_ar', { length: 255 }),
    descriptionEn: (0, pg_core_1.text)('description_en'),
    descriptionAr: (0, pg_core_1.text)('description_ar'),
    displayOrder: (0, pg_core_1.integer)('display_order').default(0),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('course_sections_uuid_idx').on(table.uuid),
    courseIdx: (0, pg_core_1.index)('course_sections_course_id_idx').on(table.courseId),
}));
exports.lessons = (0, pg_core_1.pgTable)('lessons', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    sectionId: (0, pg_core_1.bigserial)('section_id', { mode: 'number' }).references(() => exports.courseSections.id).notNull(),
    contentTypeId: (0, pg_core_1.bigserial)('content_type_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id).notNull(),
    titleEn: (0, pg_core_1.varchar)('title_en', { length: 255 }).notNull(),
    titleAr: (0, pg_core_1.varchar)('title_ar', { length: 255 }),
    descriptionEn: (0, pg_core_1.text)('description_en'),
    descriptionAr: (0, pg_core_1.text)('description_ar'),
    contentEn: (0, pg_core_1.text)('content_en'),
    contentAr: (0, pg_core_1.text)('content_ar'),
    videoUrl: (0, pg_core_1.varchar)('video_url', { length: 500 }),
    attachmentUrl: (0, pg_core_1.varchar)('attachment_url', { length: 500 }),
    durationMinutes: (0, pg_core_1.integer)('duration_minutes'),
    displayOrder: (0, pg_core_1.integer)('display_order').default(0),
    isPreview: (0, pg_core_1.boolean)('is_preview').default(false).notNull(),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('lessons_uuid_idx').on(table.uuid),
    sectionIdx: (0, pg_core_1.index)('lessons_section_id_idx').on(table.sectionId),
}));
exports.courseResources = (0, pg_core_1.pgTable)('course_resources', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    courseId: (0, pg_core_1.bigserial)('course_id', { mode: 'number' }).references(() => exports.courses.id).notNull(),
    sectionId: (0, pg_core_1.bigserial)('section_id', { mode: 'number' }).references(() => exports.courseSections.id),
    lessonId: (0, pg_core_1.bigserial)('lesson_id', { mode: 'number' }).references(() => exports.lessons.id),
    resourceTypeId: (0, pg_core_1.bigserial)('resource_type_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id).notNull(),
    titleEn: (0, pg_core_1.varchar)('title_en', { length: 255 }).notNull(),
    titleAr: (0, pg_core_1.varchar)('title_ar', { length: 255 }),
    descriptionEn: (0, pg_core_1.text)('description_en'),
    descriptionAr: (0, pg_core_1.text)('description_ar'),
    fileUrl: (0, pg_core_1.varchar)('file_url', { length: 500 }).notNull(),
    fileName: (0, pg_core_1.varchar)('file_name', { length: 255 }),
    fileSize: (0, pg_core_1.integer)('file_size'),
    downloadCount: (0, pg_core_1.integer)('download_count').default(0),
    displayOrder: (0, pg_core_1.integer)('display_order').default(0),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('course_resources_uuid_idx').on(table.uuid),
    courseIdx: (0, pg_core_1.index)('course_resources_course_id_idx').on(table.courseId),
}));
exports.assignments = (0, pg_core_1.pgTable)('assignments', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    sectionId: (0, pg_core_1.bigserial)('section_id', { mode: 'number' }).references(() => exports.courseSections.id).notNull(),
    titleEn: (0, pg_core_1.varchar)('title_en', { length: 255 }).notNull(),
    titleAr: (0, pg_core_1.varchar)('title_ar', { length: 255 }),
    descriptionEn: (0, pg_core_1.text)('description_en'),
    descriptionAr: (0, pg_core_1.text)('description_ar'),
    instructionsEn: (0, pg_core_1.text)('instructions_en'),
    instructionsAr: (0, pg_core_1.text)('instructions_ar'),
    maxPoints: (0, pg_core_1.integer)('max_points').default(100),
    dueDate: (0, pg_core_1.timestamp)('due_date', { withTimezone: true }),
    maxAttempts: (0, pg_core_1.integer)('max_attempts'),
    allowLateSubmission: (0, pg_core_1.boolean)('allow_late_submission').default(false).notNull(),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('assignments_uuid_idx').on(table.uuid),
    sectionIdx: (0, pg_core_1.index)('assignments_section_id_idx').on(table.sectionId),
}));
exports.quizzes = (0, pg_core_1.pgTable)('quizzes', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    sectionId: (0, pg_core_1.bigserial)('section_id', { mode: 'number' }).references(() => exports.courseSections.id).notNull(),
    titleEn: (0, pg_core_1.varchar)('title_en', { length: 255 }).notNull(),
    titleAr: (0, pg_core_1.varchar)('title_ar', { length: 255 }),
    descriptionEn: (0, pg_core_1.text)('description_en'),
    descriptionAr: (0, pg_core_1.text)('description_ar'),
    timeLimitMinutes: (0, pg_core_1.integer)('time_limit_minutes'),
    maxAttempts: (0, pg_core_1.integer)('max_attempts'),
    passingScore: (0, pg_core_1.integer)('passing_score').default(60),
    shuffleQuestions: (0, pg_core_1.boolean)('shuffle_questions').default(false).notNull(),
    showCorrectAnswers: (0, pg_core_1.boolean)('show_correct_answers').default(true).notNull(),
    availableFrom: (0, pg_core_1.timestamp)('available_from', { withTimezone: true }),
    availableUntil: (0, pg_core_1.timestamp)('available_until', { withTimezone: true }),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('quizzes_uuid_idx').on(table.uuid),
    sectionIdx: (0, pg_core_1.index)('quizzes_section_id_idx').on(table.sectionId),
}));
exports.questionBank = (0, pg_core_1.pgTable)('question_bank', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    courseId: (0, pg_core_1.bigserial)('course_id', { mode: 'number' }).references(() => exports.courses.id).notNull(),
    questionTypeId: (0, pg_core_1.bigserial)('question_type_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id).notNull(),
    questionTextEn: (0, pg_core_1.text)('question_text_en').notNull(),
    questionTextAr: (0, pg_core_1.text)('question_text_ar'),
    explanationEn: (0, pg_core_1.text)('explanation_en'),
    explanationAr: (0, pg_core_1.text)('explanation_ar'),
    points: (0, pg_core_1.integer)('points').default(1),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('question_bank_uuid_idx').on(table.uuid),
    courseIdx: (0, pg_core_1.index)('question_bank_course_id_idx').on(table.courseId),
}));
exports.questionOptions = (0, pg_core_1.pgTable)('question_options', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    questionId: (0, pg_core_1.bigserial)('question_id', { mode: 'number' }).references(() => exports.questionBank.id).notNull(),
    optionTextEn: (0, pg_core_1.text)('option_text_en').notNull(),
    optionTextAr: (0, pg_core_1.text)('option_text_ar'),
    isCorrect: (0, pg_core_1.boolean)('is_correct').default(false).notNull(),
    displayOrder: (0, pg_core_1.integer)('display_order').default(0),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('question_options_uuid_idx').on(table.uuid),
    questionIdx: (0, pg_core_1.index)('question_options_question_id_idx').on(table.questionId),
}));
exports.quizQuestions = (0, pg_core_1.pgTable)('quiz_questions', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    quizId: (0, pg_core_1.bigserial)('quiz_id', { mode: 'number' }).references(() => exports.quizzes.id).notNull(),
    questionId: (0, pg_core_1.bigserial)('question_id', { mode: 'number' }).references(() => exports.questionBank.id).notNull(),
    displayOrder: (0, pg_core_1.integer)('display_order').default(0),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('quiz_questions_uuid_idx').on(table.uuid),
    quizIdx: (0, pg_core_1.index)('quiz_questions_quiz_id_idx').on(table.quizId),
}));
exports.enrollments = (0, pg_core_1.pgTable)('enrollments', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    userId: (0, pg_core_1.bigserial)('userId', { mode: 'number' }).references(() => users_schema_1.users.id).notNull(),
    courseId: (0, pg_core_1.bigserial)('course_id', { mode: 'number' }).references(() => exports.courses.id).notNull(),
    enrollmentTypeId: (0, pg_core_1.bigserial)('enrollment_type_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id).notNull(),
    statusId: (0, pg_core_1.bigserial)('status_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id).notNull(),
    subscriptionId: (0, pg_core_1.bigserial)('subscription_id', { mode: 'number' }).references(() => subscriptions_schema_1.subscriptions.id),
    amountPaid: (0, pg_core_1.decimal)('amount_paid', { precision: 10, scale: 2 }),
    enrolledAt: (0, pg_core_1.timestamp)('enrolled_at', { withTimezone: true }).defaultNow().notNull(),
    expiresAt: (0, pg_core_1.timestamp)('expires_at', { withTimezone: true }),
    completedAt: (0, pg_core_1.timestamp)('completed_at', { withTimezone: true }),
    progressPercentage: (0, pg_core_1.decimal)('progress_percentage', { precision: 5, scale: 2 }).default('0'),
    lastAccessedAt: (0, pg_core_1.timestamp)('last_accessed_at', { withTimezone: true }),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('enrollments_uuid_idx').on(table.uuid),
    userIdx: (0, pg_core_1.index)('enrollments_userId_idx').on(table.userId),
    courseIdx: (0, pg_core_1.index)('enrollments_course_id_idx').on(table.courseId),
}));
exports.lessonProgress = (0, pg_core_1.pgTable)('lesson_progress', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    enrollmentId: (0, pg_core_1.bigserial)('enrollment_id', { mode: 'number' }).references(() => exports.enrollments.id).notNull(),
    lessonId: (0, pg_core_1.bigserial)('lesson_id', { mode: 'number' }).references(() => exports.lessons.id).notNull(),
    isCompleted: (0, pg_core_1.boolean)('is_completed').default(false).notNull(),
    timeSpentMinutes: (0, pg_core_1.integer)('time_spent_minutes').default(0),
    completedAt: (0, pg_core_1.timestamp)('completed_at', { withTimezone: true }),
    lastAccessedAt: (0, pg_core_1.timestamp)('last_accessed_at', { withTimezone: true }),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('lesson_progress_uuid_idx').on(table.uuid),
    enrollmentIdx: (0, pg_core_1.index)('lesson_progress_enrollment_id_idx').on(table.enrollmentId),
    lessonIdx: (0, pg_core_1.index)('lesson_progress_lesson_id_idx').on(table.lessonId),
}));
exports.assignmentSubmissions = (0, pg_core_1.pgTable)('assignment_submissions', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    assignmentId: (0, pg_core_1.bigserial)('assignment_id', { mode: 'number' }).references(() => exports.assignments.id).notNull(),
    userId: (0, pg_core_1.bigserial)('userId', { mode: 'number' }).references(() => users_schema_1.users.id).notNull(),
    submissionText: (0, pg_core_1.text)('submission_text'),
    fileUrl: (0, pg_core_1.varchar)('file_url', { length: 500 }),
    statusId: (0, pg_core_1.bigserial)('status_id', { mode: 'number' }).references(() => lookups_schema_1.lookups.id).notNull(),
    score: (0, pg_core_1.decimal)('score', { precision: 5, scale: 2 }),
    maxPoints: (0, pg_core_1.decimal)('max_points', { precision: 5, scale: 2 }),
    feedback: (0, pg_core_1.text)('feedback'),
    submittedAt: (0, pg_core_1.timestamp)('submitted_at', { withTimezone: true }).defaultNow(),
    gradedAt: (0, pg_core_1.timestamp)('graded_at', { withTimezone: true }),
    gradedBy: (0, pg_core_1.bigserial)('graded_by', { mode: 'number' }).references(() => users_schema_1.users.id),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('assignment_submissions_uuid_idx').on(table.uuid),
    assignmentIdx: (0, pg_core_1.index)('assignment_submissions_assignment_id_idx').on(table.assignmentId),
    userIdx: (0, pg_core_1.index)('assignment_submissions_userId_idx').on(table.userId),
}));
exports.quizAttempts = (0, pg_core_1.pgTable)('quiz_attempts', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    quizId: (0, pg_core_1.bigserial)('quiz_id', { mode: 'number' }).references(() => exports.quizzes.id).notNull(),
    userId: (0, pg_core_1.bigserial)('userId', { mode: 'number' }).references(() => users_schema_1.users.id).notNull(),
    attemptNumber: (0, pg_core_1.integer)('attempt_number').notNull(),
    score: (0, pg_core_1.decimal)('score', { precision: 5, scale: 2 }),
    maxScore: (0, pg_core_1.decimal)('max_score', { precision: 5, scale: 2 }),
    isPassed: (0, pg_core_1.boolean)('is_passed').default(false).notNull(),
    startedAt: (0, pg_core_1.timestamp)('started_at', { withTimezone: true }).defaultNow(),
    completedAt: (0, pg_core_1.timestamp)('completed_at', { withTimezone: true }),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('quiz_attempts_uuid_idx').on(table.uuid),
    quizIdx: (0, pg_core_1.index)('quiz_attempts_quiz_id_idx').on(table.quizId),
    userIdx: (0, pg_core_1.index)('quiz_attempts_userId_idx').on(table.userId),
}));
exports.quizAnswers = (0, pg_core_1.pgTable)('quiz_answers', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    attemptId: (0, pg_core_1.bigserial)('attempt_id', { mode: 'number' }).references(() => exports.quizAttempts.id).notNull(),
    questionId: (0, pg_core_1.bigserial)('question_id', { mode: 'number' }).references(() => exports.questionBank.id).notNull(),
    selectedOptionId: (0, pg_core_1.bigserial)('selected_option_id', { mode: 'number' }).references(() => exports.questionOptions.id),
    answerText: (0, pg_core_1.text)('answer_text'),
    isCorrect: (0, pg_core_1.boolean)('is_correct').default(false).notNull(),
    pointsEarned: (0, pg_core_1.decimal)('points_earned', { precision: 5, scale: 2 }),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('quiz_answers_uuid_idx').on(table.uuid),
    attemptIdx: (0, pg_core_1.index)('quiz_answers_attempt_id_idx').on(table.attemptId),
}));
exports.courseReviews = (0, pg_core_1.pgTable)('course_reviews', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    courseId: (0, pg_core_1.bigserial)('course_id', { mode: 'number' }).references(() => exports.courses.id).notNull(),
    userId: (0, pg_core_1.bigserial)('userId', { mode: 'number' }).references(() => users_schema_1.users.id).notNull(),
    rating: (0, pg_core_1.integer)('rating').notNull(),
    reviewText: (0, pg_core_1.text)('review_text'),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    updatedAt: (0, pg_core_1.timestamp)('updatedAt', { withTimezone: true }).defaultNow(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('course_reviews_uuid_idx').on(table.uuid),
    courseIdx: (0, pg_core_1.index)('course_reviews_course_id_idx').on(table.courseId),
    userIdx: (0, pg_core_1.index)('course_reviews_userId_idx').on(table.userId),
}));
exports.certificates = (0, pg_core_1.pgTable)('certificates', {
    id: (0, pg_core_1.bigserial)('id', { mode: 'number' }).primaryKey(),
    uuid: (0, pg_core_1.uuid)('uuid').defaultRandom().notNull().unique(),
    enrollmentId: (0, pg_core_1.bigserial)('enrollment_id', { mode: 'number' }).references(() => exports.enrollments.id).notNull(),
    certificateNumber: (0, pg_core_1.varchar)('certificate_number', { length: 100 }).notNull().unique(),
    issuedDate: (0, pg_core_1.timestamp)('issued_date', { withTimezone: true }).defaultNow(),
    fileUrl: (0, pg_core_1.varchar)('file_url', { length: 500 }),
    downloadUrl: (0, pg_core_1.varchar)('download_url', { length: 500 }),
    downloadCount: (0, pg_core_1.integer)('download_count').default(0),
    isDeleted: (0, pg_core_1.boolean)('isDeleted').default(false).notNull(),
    createdAt: (0, pg_core_1.timestamp)('createdAt', { withTimezone: true }).defaultNow().notNull(),
    deletedAt: (0, pg_core_1.timestamp)('deletedAt', { withTimezone: true }),
}, (table) => ({
    uuidIdx: (0, pg_core_1.index)('certificates_uuid_idx').on(table.uuid),
    enrollmentIdx: (0, pg_core_1.index)('certificates_enrollment_id_idx').on(table.enrollmentId),
    certificateNumberIdx: (0, pg_core_1.index)('certificates_certificate_number_idx').on(table.certificateNumber),
}));
exports.coursesRelations = (0, drizzle_orm_1.relations)(exports.courses, ({ one, many }) => ({
    instructor: one(users_schema_1.users, {
        fields: [exports.courses.instructorId],
        references: [users_schema_1.users.id],
    }),
    category: one(exports.courseCategories, {
        fields: [exports.courses.categoryId],
        references: [exports.courseCategories.id],
    }),
    status: one(lookups_schema_1.lookups, {
        fields: [exports.courses.statusId],
        references: [lookups_schema_1.lookups.id],
    }),
    sections: many(exports.courseSections),
    enrollments: many(exports.enrollments),
    reviews: many(exports.courseReviews),
    resources: many(exports.courseResources),
    questionBank: many(exports.questionBank),
}));
exports.courseSectionsRelations = (0, drizzle_orm_1.relations)(exports.courseSections, ({ one, many }) => ({
    course: one(exports.courses, {
        fields: [exports.courseSections.courseId],
        references: [exports.courses.id],
    }),
    lessons: many(exports.lessons),
    assignments: many(exports.assignments),
    quizzes: many(exports.quizzes),
    resources: many(exports.courseResources),
}));
exports.lessonsRelations = (0, drizzle_orm_1.relations)(exports.lessons, ({ one, many }) => ({
    section: one(exports.courseSections, {
        fields: [exports.lessons.sectionId],
        references: [exports.courseSections.id],
    }),
    contentType: one(lookups_schema_1.lookups, {
        fields: [exports.lessons.contentTypeId],
        references: [lookups_schema_1.lookups.id],
    }),
    progress: many(exports.lessonProgress),
    resources: many(exports.courseResources),
}));
exports.enrollmentsRelations = (0, drizzle_orm_1.relations)(exports.enrollments, ({ one, many }) => ({
    user: one(users_schema_1.users, {
        fields: [exports.enrollments.userId],
        references: [users_schema_1.users.id],
    }),
    course: one(exports.courses, {
        fields: [exports.enrollments.courseId],
        references: [exports.courses.id],
    }),
    enrollmentType: one(lookups_schema_1.lookups, {
        fields: [exports.enrollments.enrollmentTypeId],
        references: [lookups_schema_1.lookups.id],
    }),
    status: one(lookups_schema_1.lookups, {
        fields: [exports.enrollments.statusId],
        references: [lookups_schema_1.lookups.id],
    }),
    subscription: one(subscriptions_schema_1.subscriptions, {
        fields: [exports.enrollments.subscriptionId],
        references: [subscriptions_schema_1.subscriptions.id],
    }),
    lessonProgress: many(exports.lessonProgress),
    certificates: many(exports.certificates),
}));
//# sourceMappingURL=lms.schema.js.map